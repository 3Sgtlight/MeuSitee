<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconhecimento Facial - Teachable Machine</title>

    <!-- CSS interno semântico e responsivo -->
    <style>
        :root{
            --bg:#0f1724;
            --card:#0b1220;
            --accent:#3b82f6;
            --text:#e6eef8;
            --muted:#9fb4d6;
            --gap:1rem;
        }

        html,body{
            height:100%;
            margin:0;
            font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background:linear-gradient(180deg,#071028 0%, #0b1220 100%);
            color:var(--text);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        .site{
            min-height:100%;
            display:flex;
            flex-direction:column;
        }

        header{
            background:linear-gradient(90deg, rgba(59,130,246,0.08), transparent 60%);
            padding:1rem 1.25rem;
            border-bottom:1px solid rgba(255,255,255,0.03);
        }

        .container{
            max-width:980px;
            margin:1.25rem auto;
            width:calc(100% - 2.5rem);
        }

        h1{
            margin:0;
            font-size:1.25rem;
            color:var(--text);
            letter-spacing:0.2px;
        }

        main{
            display:grid;
            grid-template-columns: 360px 1fr;
            gap:var(--gap);
            align-items:start;
        }

        @media (max-width:880px){
            main{
                grid-template-columns: 1fr;
            }
        }

        aside.card, section.card{
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid rgba(255,255,255,0.03);
            padding:1rem;
            border-radius:10px;
            box-shadow: 0 6px 18px rgba(3,7,18,0.6);
        }

        .controls{
            display:flex;
            gap:0.5rem;
            margin-top:0.75rem;
            flex-wrap:wrap;
        }

        button.primary{
            background:var(--accent);
            color:white;
            border:0;
            padding:0.55rem 0.85rem;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }

        button.ghost{
            background:transparent;
            color:var(--muted);
            border:1px solid rgba(255,255,255,0.04);
            padding:0.45rem 0.8rem;
            border-radius:8px;
            cursor:pointer;
        }

        #webcam-container{
            display:flex;
            justify-content:center;
            align-items:center;
            min-height:220px;
        }

        canvas{
            border-radius:8px;
            max-width:100%;
            box-shadow: 0 8px 24px rgba(11,18,32,0.6);
            border:1px solid rgba(255,255,255,0.03);
        }

        #label-container{
            margin-top:0.5rem;
            display:flex;
            flex-direction:column;
            gap:0.35rem;
            color:var(--muted);
            font-size:0.95rem;
        }

        .meta{
            font-size:0.9rem;
            color:var(--muted);
            margin-top:0.75rem;
        }

        footer{
            margin-top:auto;
            padding:1rem 1.25rem;
            font-size:0.85rem;
            color:var(--muted);
            border-top:1px solid rgba(255,255,255,0.02);
            background:transparent;
        }

        .notice{
            background:rgba(59,130,246,0.06);
            border-left:4px solid rgba(59,130,246,0.24);
            padding:0.6rem;
            border-radius:6px;
            color:var(--text);
            font-size:0.95rem;
        }
    </style>
</head>
<body>
    <div class="site">
        <header>
            <div class="container">
                <h1>Reconhecimento Facial com Teachable Machine</h1>
            </div>
        </header>

        <main class="container" role="main">
            <aside class="card" aria-labelledby="controls-title">
                <h2 id="controls-title" style="margin-top:0; font-size:1rem; color:var(--text);">Controles</h2>

                <p class="meta">Inicie a câmera e visualize as previsões do modelo local exportado do Teachable Machine.</p>

                <div class="controls" role="group" aria-label="Controles da câmera">
                    <!-- O botão Start original (mantido) -->
                    <button type="button" onclick="init()" class="primary" id="start-btn">Start</button>

                    <!-- Botão pause/resume adicionado -->
                    <button type="button" id="pause-btn" class="ghost" aria-pressed="false">Pausar câmera</button>
                </div>

                <div style="margin-top:0.8rem;">
                    <div class="notice" role="status">Ao iniciar a câmera, a abertura de novas janelas é travada para segurança.</div>
                </div>
            </aside>

            <section class="card" aria-labelledby="viewer-title">
                <h2 id="viewer-title" style="margin-top:0; font-size:1rem; color:var(--text);">Visor e Previsões</h2>

                <div id="webcam-container" aria-live="polite">
                    <div>Teachable Machine Image Model</div>
                </div>

                <div id="label-container" aria-atomic="true"></div>
            </section>
        </main>

        <footer>
            Modelo local esperado em <code>./my_model/</code>. Permissões de câmera devem ser concedidas localmente para o visor funcionar.
        </footer>
    </div>

    <!-- Bibliotecas e script original preservados integralmente -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        // More API functions here:
        // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

        // the link to your model provided by Teachable Machine export panel
        const URL = "./my_model/";

        let model, webcam, labelContainer, maxPredictions;

        // Load the image model and setup the webcam
        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // load the model and metadata
            // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
            // or files from your local hard drive
            // Note: the pose library adds "tmImage" object to your window (window.tmImage)
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // Convenience function to setup a webcam
            const flip = true; // whether to flip the webcam
            webcam = new tmImage.Webcam(200, 200, flip); // width, height, flip
            await webcam.setup(); // request access to the webcam
            await webcam.play();
            window.requestAnimationFrame(loop);

            // append elements to the DOM
            document.getElementById("webcam-container").appendChild(webcam.canvas);
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) { // and class labels
                labelContainer.appendChild(document.createElement("div"));
            }
        }

        async function loop() {
            webcam.update(); // update the webcam frame
            await predict();
            window.requestAnimationFrame(loop);
        }

        // run the webcam image through the image model
        async function predict() {
            // predict can take in an image, video or canvas html element
            const prediction = await model.predict(webcam.canvas);
            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction =
                    prediction[i].className + ": " + prediction[i].probability.toFixed(2);
                labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }
    </script>

    <!-- Script adicional para travar novas janelas ao iniciar a câmera e adicionar pausa -->
    <script>
        // Bloqueia window.open no momento do início da câmera
        (function(){
            const startBtn = document.getElementById('start-btn');
            // Capturing listener to run before inline onclick
            startBtn.addEventListener('pointerdown', function onPointerDown(e){
                // Sobrescreve window.open para impedir abertura de novas janelas
                window.open = function(){ return null; };
                // Evita links com target _blank no carregamento interferirem
                document.addEventListener('click', function stopBlank(e){
                    const a = e.target.closest && e.target.closest('a');
                    if(a && a.target === '_blank') e.preventDefault();
                }, {capture:true});
                // Remove este listener após primeira execução
                startBtn.removeEventListener('pointerdown', onPointerDown, true);
            }, true);

            // Botão de pause/resume
            const pauseBtn = document.getElementById('pause-btn');
            let isPaused = false;

            pauseBtn.addEventListener('click', async function(){
                if (!webcam) {
                    // Se a câmera ainda não foi iniciada, apenas inverte o texto
                    isPaused = !isPaused;
                    pauseBtn.textContent = isPaused ? 'Retomar câmera' : 'Pausar câmera';
                    pauseBtn.setAttribute('aria-pressed', String(isPaused));
                    return;
                }
                if (!isPaused) {
                    // Pausar: pare as tracks de vídeo se disponível
                    try {
                        if (typeof webcam.stop === 'function') {
                            webcam.stop();
                        } else if (webcam.webcam && webcam.webcam.video && webcam.webcam.video.srcObject) {
                            const stream = webcam.webcam.video.srcObject;
                            const tracks = stream.getTracks();
                            tracks.forEach(t => t.stop());
                        }
                    } catch (err) {
                        console.warn('Erro ao tentar pausar a câmera', err);
                    }
                    pauseBtn.textContent = 'Retomar câmera';
                    pauseBtn.setAttribute('aria-pressed','true');
                    isPaused = true;
                } else {
                    // Retomar: tente dar play novamente
                    try {
                        if (typeof webcam.play === 'function') {
                            await webcam.play();
                        } else if (webcam.webcam && webcam.webcam.video) {
                            await webcam.webcam.video.play();
                        }
                        // continue o loop de animação caso tenha sido pausado automaticamente
                        window.requestAnimationFrame(loop);
                    } catch (err) {
                        console.warn('Erro ao tentar retomar a câmera', err);
                    }
                    pauseBtn.textContent = 'Pausar câmera';
                    pauseBtn.setAttribute('aria-pressed','false');
                    isPaused = false;
                }
            });
        })();
    </script>
</body>
</html>
```