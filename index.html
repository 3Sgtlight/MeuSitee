<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Reconhecimento Facial — Hacker UI</title>
<style>
:root{
  --bg:#020204;
  --panel:#041014;
  --accent:#00ff66;
  --accent-dim:#00b356;
  --glow:rgba(0,255,102,0.15);
  --muted:#6fbf9a;
  --glass:rgba(255,255,255,0.02);
  --radius:10px;
  --card-shadow: 0 20px 80px rgba(0,0,0,0.8);
  --mono: "Source Code Pro", ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
}

/* base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:
  radial-gradient(800px 300px at 10% 10%, rgba(0,255,102,0.02), transparent 6%),
  linear-gradient(180deg,#000,#021014);color:var(--muted);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
a{color:var(--accent);}

/* layout central estilo terminal */
.outer{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
}
.hud{
  width:100%;
  max-width:1180px;
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:20px;
  background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(4,16,20,0.55));
  border:1px solid rgba(0,255,102,0.06);
  border-radius:14px;
  padding:18px;
  box-shadow:var(--card-shadow);
  position:relative;
  overflow:hidden;
}
@media (max-width:920px){ .hud{grid-template-columns:1fr;padding:12px} }

/* animated scan & noise */
.grid-overlay{
  position:absolute;inset:0;pointer-events:none;
  background-image:
    linear-gradient(90deg, rgba(0,255,102,0.02) 1px, transparent 1px),
    linear-gradient(180deg, rgba(0,180,86,0.02) 1px, transparent 1px);
  mix-blend-mode:screen;
  background-size:140px 140px, 160px 160px;
  opacity:0.85;
}
.scan{
  position:absolute;left:0;right:0;height:2px;top:-20%;
  background:linear-gradient(90deg, transparent, rgba(0,255,102,0.12), transparent);
  animation:scan 5s linear infinite;mix-blend-mode:screen;pointer-events:none;
}
@keyframes scan{0%{top:-20%}50%{top:120%}100%{top:-20%}}

/* left panel: terminal controls */
.left{
  background:linear-gradient(180deg, rgba(2,8,6,0.8), rgba(2,12,10,0.7));
  border-radius:10px;padding:16px;border:1px solid rgba(0,255,102,0.04);display:flex;flex-direction:column;gap:12px;
}
.brand{
  display:flex;gap:12px;align-items:center;
}
.logo{
  width:64px;height:64px;border-radius:8px;display:grid;place-items:center;
  background:linear-gradient(135deg,#002a0a,#005a2a);color:var(--accent);font-weight:900;font-family:var(--mono);
  font-size:20px;box-shadow:0 8px 30px rgba(0,255,102,0.06);
}
.title h1{margin:0;font-size:16px;color:var(--accent)}
.title p{margin:0;font-size:13px;color:var(--muted)}

/* faux terminal log */
.terminal{
  background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.25));
  border-radius:8px;padding:12px;border:1px solid rgba(0,255,102,0.03);font-family:var(--mono);font-size:13px;color:#bfffe0;height:220px;overflow:auto;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
}
.terminal .line{white-space:pre-wrap;margin:0 0 6px 0}

/* control buttons styled like console keys */
.controls{display:flex;gap:8px;flex-wrap:wrap}
.btn{
  border:0;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700;font-family:var(--mono);
  color:#001814;background:transparent;border:1px solid rgba(255,255,255,0.02);
}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-dim));box-shadow:0 8px 20px rgba(0,255,102,0.06);color:#001814}
.btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}
.small{padding:8px 10px;font-size:13px;border-radius:8px}

/* readouts */
.readouts{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.readout{background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));padding:8px;border-radius:8px;border:1px solid rgba(0,255,102,0.03);min-width:110px;text-align:center}
.readout .num{font-family:var(--mono);font-weight:900;color:var(--accent);font-size:15px}

/* right panel: visor with HUD */
.right{display:flex;flex-direction:column;gap:12px}
.hud-top{display:flex;justify-content:space-between;align-items:center}
.hud-top .meta{color:var(--muted);font-size:13px}

/* camera viewport — neon frame */
.viewport{
  background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(2,8,6,0.55));
  border-radius:10px;padding:12px;border:1px solid rgba(0,255,102,0.06);position:relative;
  box-shadow: 0 16px 60px rgba(0,0,0,0.7);
}
.frame{
  display:flex;justify-content:center;align-items:center;padding:6px;border-radius:8px;border:1px solid rgba(0,255,102,0.08);
  box-shadow: 0 10px 40px rgba(0,255,102,0.04) inset; background:linear-gradient(180deg, rgba(0,255,102,0.01), rgba(0,0,0,0.08));
}
#webcam-container{min-height:380px;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center;position:relative}

/* HUD chips — ensure three visible columns with labels and progress bars */
.hud-row{display:flex;gap:10px;align-items:stretch;justify-content:space-between}
.hud-chip{
  flex:1 1 0;min-width:0;background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.25));
  border-radius:8px;padding:10px;border:1px solid rgba(0,255,102,0.04);font-family:var(--mono);font-size:13px;color:#caffd9;
  display:flex;flex-direction:column;gap:8px;align-items:flex-start;
}
.hud-chip .label{font-weight:900;color:var(--accent);font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.hud-chip .bar{
  width:100%;height:10px;border-radius:6px;background:rgba(255,255,255,0.03);overflow:hidden;border:1px solid rgba(0,255,102,0.03)
}
.hud-chip .bar > i{
  display:block;height:100%;background:linear-gradient(90deg,var(--accent),#8bf7b7);width:0%;box-shadow:0 6px 18px rgba(0,255,102,0.12) inset;
}
.hud-chip .pct{font-family:var(--mono);font-weight:800;color:var(--accent);font-size:13px}

/* visual detection reticle */
.reticle{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:260px;height:260px;border-radius:50%;
  pointer-events:none;border:2px dashed rgba(0,255,102,0.08);box-shadow:0 0 40px rgba(0,255,102,0.02) inset;
}

/* alert / status line */
.status-line{font-family:var(--mono);font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;gap:12px}

/* footer */
.foot{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--muted);margin-top:6px}
kbd{background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.02);padding:4px 6px;border-radius:6px;font-family:var(--mono);color:var(--accent)}

/* scrollbars for terminal look */
.terminal::-webkit-scrollbar{height:8px;width:8px}
.terminal::-webkit-scrollbar-thumb{background:linear-gradient(90deg, rgba(0,255,102,0.12), rgba(0,255,102,0.06));border-radius:6px}
.terminal::-webkit-scrollbar-track{background:transparent}

button:focus{outline:3px solid rgba(0,255,102,0.08);outline-offset:2px}
code{background:rgba(255,255,255,0.02);padding:2px 6px;border-radius:6px;font-family:var(--mono)}
</style>
</head>
<body>
<div class="outer">
  <div class="hud" role="main" aria-label="Painel hacker de reconhecimento facial">
    <div class="grid-overlay" aria-hidden="true"></div>
    <div class="scan" aria-hidden="true"></div>

    <aside class="left" aria-labelledby="left-title">
      <div class="brand">
        <div class="logo" aria-hidden="true">0xAI</div>
        <div class="title">
          <h1 id="left-title">FACEREC HACK UI</h1>
          <p>Modo: Offline · Segurança: Hardened</p>
        </div>
      </div>

      <div class="terminal" id="terminal" role="log" aria-live="polite" aria-atomic="false">
        <div class="line">booting modules...</div>
        <div class="line">loading tfjs ...</div>
        <div class="line">loading model metadata ...</div>
        <div class="line">awaiting user start</div>
      </div>

      <div class="controls" aria-label="Controles">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="start-btn" class="btn primary" type="button">START</button>
          <button id="pause-btn" class="btn ghost small" type="button" aria-pressed="false">PAUSE</button>
          <button id="clear-btn" class="btn ghost small" type="button">RESET HUD</button>
        </div>

        <div class="readouts">
          <div class="readout"><div class="num" id="status-num">—</div><div style="font-size:12px;color:var(--muted)">Uptime</div></div>
          <div class="readout"><div class="num" id="cam-res">—</div><div style="font-size:12px;color:var(--muted)">Cam</div></div>
          <div class="readout"><div class="num" id="pred-count">—</div><div style="font-size:12px;color:var(--muted)">Classes</div></div>
        </div>
      </div>

      <div class="status-line" aria-hidden="false">
        <div>Local model: <code>./my_model/</code></div>
        <div>Mode: <kbd>HARDENED</kbd></div>
      </div>
    </aside>

    <section class="right" aria-labelledby="right-title">
      <div class="hud-top">
        <div>
          <strong id="right-title" style="font-family:var(--mono);color:var(--accent)">VISOR</strong>
          <div class="meta">Canvas ao vivo · HUD de previsões</div>
        </div>
        <div class="meta">Teachable Machine · TensorFlow.js</div>
      </div>

      <div class="viewport" role="region" aria-label="Visor da câmera">
        <div class="frame">
          <div id="webcam-container">
            <div style="color:var(--muted);font-family:var(--mono);font-weight:700">Teachable Machine Image Model</div>
          </div>
          <div class="reticle" aria-hidden="true"></div>
        </div>

        <div style="margin-top:10px">
          <div class="hud-row" id="label-container" role="status" aria-live="polite" aria-atomic="true">
            <div class="hud-chip" id="chip-0"><div class="label">Class 1</div><div class="bar"><i style="width:0%"></i></div><div class="pct">0%</div></div>
            <div class="hud-chip" id="chip-1"><div class="label">Class 2</div><div class="bar"><i style="width:0%"></i></div><div class="pct">0%</div></div>
            <div class="hud-chip" id="chip-2"><div class="label">Class 3</div><div class="bar"><i style="width:0%"></i></div><div class="pct">0%</div></div>
          </div>
        </div>

        <div class="foot" style="margin-top:12px">
          <div>status: <span id="terminal-status" style="color:var(--accent)">idle</span></div>
          <div>ui: 0xface</div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- libs originais -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
/* configuração do modelo local */
const URL = "./my_model/";
let model, webcam, maxPredictions;
let terminal = document.getElementById('terminal');
let terminalStatus = document.getElementById('terminal-status');
let statusNum = document.getElementById('status-num');
let predCountEl = document.getElementById('pred-count');
let camResEl = document.getElementById('cam-res');

/* bloquear window.open após interação segura */
if (!window.__origOpen) window.__origOpen = window.open;
let openLocked = false;
function lockOpen(){
  if (openLocked) return;
  try {
    window.open = function(){ return null; };
    document.addEventListener('click', function stopBlank(e){
      const a = e.target.closest && e.target.closest('a');
      if (a && a.target === '_blank') e.preventDefault();
    }, {capture:true});
    openLocked = true;
  } catch(e){ console.warn('lock failed',e); }
}

/* escreve no terminal com timestamp */
function logLine(text){
  const time = new Date().toLocaleTimeString();
  const div = document.createElement('div');
  div.className = 'line';
  div.textContent = '['+time+'] ' + text;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

/* limpeza de instâncias anteriores (impede multiplas janelas/canvases) */
function cleanup(){
  try {
    if (webcam){
      if (typeof webcam.stop === 'function') webcam.stop();
      else if (webcam.webcam && webcam.webcam.video && webcam.webcam.video.srcObject){
        webcam.webcam.video.srcObject.getTracks().forEach(t=>t.stop());
      }
    }
  } catch(e){ console.warn('cleanup',e); }
  const wc = document.getElementById('webcam-container');
  if (wc) {
    wc.querySelectorAll('canvas,video').forEach(n=>n.remove());
  }
  webcam = null;
}

/* inicializa modelo e webcam de maneira segura */
async function init(){
  lockOpen();
  logLine('initiating model load...');
  terminalStatus.textContent = 'loading model';
  cleanup();

  const modelURL = URL + "model.json";
  const metadataURL = URL + "metadata.json";

  model = await tmImage.load(modelURL, metadataURL);
  maxPredictions = model.getTotalClasses();
  predCountEl.textContent = String(maxPredictions);
  logLine('model loaded, classes=' + maxPredictions);

  // webcam maior para melhor leitura
  webcam = new tmImage.Webcam(640,480,true);
  await webcam.setup();
  try { if (webcam.webcam && webcam.webcam.video){ webcam.webcam.video.setAttribute('playsinline',''); webcam.webcam.video.setAttribute('muted',''); webcam.webcam.video.setAttribute('autoplay',''); } } catch(e){}
  await webcam.play();

  // inserir canvas único
  document.getElementById('webcam-container').appendChild(webcam.canvas);
  camResEl.textContent = webcam.canvas.width + '×' + webcam.canvas.height;
  statusNum.textContent = '0s';
  terminalStatus.textContent = 'active';
  logLine('camera started ' + camResEl.textContent);

  // garantir 3 chips visíveis com nomes do modelo
  const labels = [];
  for (let i=0;i<maxPredictions;i++) labels.push(model.getClassLabel ? model.getClassLabel(i) : (model.getClassMetadata ? (model.getClassMetadata(i).name || ('Class '+(i+1))) : 'Class '+(i+1)));
  // fill HUD chips
  for (let i=0;i<3;i++){
    const chip = document.getElementById('chip-'+i);
    const name = labels[i] || ('Class '+(i+1));
    chip.querySelector('.label').textContent = name;
    chip.querySelector('.bar > i').style.width = '0%';
    chip.querySelector('.pct').textContent = '0%';
  }

  // start loop
  startTime = Date.now();
  window.requestAnimationFrame(loop);
}

/* predict loop */
let startTime = 0;
async function loop(){
  if (!webcam || !model) return;
  try {
    webcam.update();
    const prediction = await model.predict(webcam.canvas);
    // update top three predictions (if model has fewer, placeholders remain)
    for (let i=0;i<3;i++){
      const chip = document.getElementById('chip-'+i);
      const bar = chip.querySelector('.bar > i');
      const pct = chip.querySelector('.pct');
      const label = chip.querySelector('.label');
      if (i < prediction.length){
        const p = prediction[i].probability;
        label.textContent = prediction[i].className;
        const w = Math.round(p*100) + '%';
        bar.style.width = w;
        pct.textContent = w;
        // glow intensity by probability
        if (p > 0.8) bar.style.boxShadow = '0 12px 36px rgba(0,255,102,0.24) inset';
        else if (p > 0.5) bar.style.boxShadow = '0 8px 24px rgba(0,255,102,0.16) inset';
        else bar.style.boxShadow = '0 4px 12px rgba(0,255,102,0.08) inset';
      } else {
        label.textContent = '—';
        bar.style.width = '0%';
        pct.textContent = '0%';
        bar.style.boxShadow = 'none';
      }
    }
    // uptime
    const s = Math.floor((Date.now()-startTime)/1000);
    statusNum.textContent = s + 's';
  } catch(e){
    console.warn('loop error', e);
    logLine('prediction error: ' + e.message);
  }
  window.requestAnimationFrame(loop);
}

/* UI controls */
document.getElementById('start-btn').addEventListener('click', async function(){
  this.disabled = true; this.textContent = 'BOOT...';
  try {
    await init();
    logLine('system online');
  } catch(e){
    logLine('init failed: ' + (e && e.message ? e.message : e));
  } finally {
    this.disabled = false; this.textContent = 'START';
  }
});

let paused = false;
document.getElementById('pause-btn').addEventListener('click', async function(){
  if (!webcam){
    paused = !paused;
    this.textContent = paused ? 'RESUME' : 'PAUSE';
    return;
  }
  if (!paused){
    try {
      if (typeof webcam.stop === 'function') webcam.stop();
      else if (webcam.webcam && webcam.webcam.video && webcam.webcam.video.srcObject) webcam.webcam.video.srcObject.getTracks().forEach(t=>t.stop());
      terminalStatus.textContent = 'paused';
      logLine('camera paused');
    } catch(e){ console.warn(e); }
    this.textContent = 'RESUME';
    paused = true;
  } else {
    try {
      if (typeof webcam.play === 'function') await webcam.play();
      else if (webcam.webcam && webcam.webcam.video) await webcam.webcam.video.play();
      terminalStatus.textContent = 'active';
      window.requestAnimationFrame(loop);
      logLine('camera resumed');
    } catch(e){ console.warn(e); }
    this.textContent = 'PAUSE';
    paused = false;
  }
});

/* reset HUD */
document.getElementById('clear-btn').addEventListener('click', function(){
  logLine('HUD reset');
  for (let i=0;i<3;i++){
    const chip = document.getElementById('chip-'+i);
    chip.querySelector('.label').textContent = 'Class ' + (i+1);
    chip.querySelector('.bar > i').style.width = '0%';
    chip.querySelector('.pct').textContent = '0%';
  }
  terminalStatus.textContent = 'idle';
});

/* prevent multiple windows on first user interaction */
document.addEventListener('pointerdown', function once(){
  try { lockOpen(); logLine('window.open locked'); } catch(e){}
  document.removeEventListener('pointerdown', once);
});
</script>
</body>
</html>
```
